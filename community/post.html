<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>글 상세</title>
<style>
body { font-family: Arial; padding: 20px; max-width: 700px; margin: auto; }
#comments { margin-top: 30px; }
.comment { border-top: 1px solid #ccc; padding: 5px; }
button { cursor: pointer; padding: 5px; margin-top: 5px; }
textarea { width: 100%; margin-top: 10px; }
</style>
</head>
<body>

<h1 id="post-title"></h1>
<p id="post-content"></p>
<small id="post-views"></small>

<h3>댓글</h3>
<div id="comments"></div>
<textarea id="comment-input" placeholder="댓글 입력"></textarea>
<button onclick="addComment()">댓글 작성</button>

<script>
const API_BASE = "https://community-xabl.onrender.com/api";
const params = new URLSearchParams(window.location.search);
const postId = params.get("id");

async function fetchPost() {
  try {
    const res = await fetch(`${API_BASE}/posts/${postId}`);
    const post = await res.json();
    document.getElementById("post-title").innerText = post.title;
    document.getElementById("post-content").innerText = post.content;
    document.getElementById("post-views").innerText = `조회수: ${post.views}`;
  } catch(err){ console.error(err); alert("글 불러오기 실패"); }
}

async function fetchComments() {
  try {
    const res = await fetch(`${API_BASE}/comments/${postId}`);
    const comments = await res.json();
    const div = document.getElementById("comments");
    div.innerHTML = "";
    comments.forEach(c => {
      const comDiv = document.createElement("div");
      comDiv.className = "comment";
      comDiv.innerText = c.content;
      div.appendChild(comDiv);
    });
  } catch(err){ console.error(err); alert("댓글 불러오기 실패"); }
}

async function addComment() {
  const content = document.getElementById("comment-input").value.trim();
  if(!content) return alert("댓글 내용을 입력해주세요.");
  try {
    const res = await fetch(`${API_BASE}/comments`, {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      credentials:"include",
      body: JSON.stringify({ postId, content })
    });
    if(res.ok) { document.getElementById("comment-input").value=""; fetchComments(); }
    else alert(await res.json());
  } catch(err){ console.error(err); alert("댓글 작성 실패"); }
}

fetchPost();
fetchComments();
</script>

</body>
</html>
